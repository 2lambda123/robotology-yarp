#
# $Id: Makefile.src.template,v 1.4 2006-03-21 11:31:51 eshuy Exp $
#

include $(YARP_ROOT)/conf/Makefile.template

TARGETS = $(patsubst %.cpp, $(GENDIR)/%.o, $(wildcard *.cpp)) $(patsubst %.c, $(GENDIR)/%.o, $(wildcard *.c))

CFLAGS = -D_REENTRANT -Wall $(CFAST) $(INCS) $(CDEFS)

SUBDIRS =

CODELIB = $(MYCODELIB).a

INCS = $(MYINCS) $(YARPSYSINC)

GENDIR = ../obj/$(OS)

LIBGENDIR = ../lib/$(OS)

VPATH += $(GENDIR)

default: $(LIBGENDIR)/$(CODELIB)
#	echo $(MYCODELIB)

all: target

ifeq ($(OS),winnt)
target: msdev
else
target: $(TARGETS) $(LIBGENDIR)/$(CODELIB) subtarget
endif

w:
	@echo -n

$(GENDIR)/%.o: %.cpp
	mkdir -p $(GENDIR)
	$(CC) $(CFLAGS) -c $< -o $@

$(GENDIR)/%.o: %.c
	mkdir -p $(GENDIR)
	$(CC1) $(CFLAGS) -c $< -o $@


$(LIBGENDIR)/$(CODELIB): $(TARGETS)
	mkdir -p $(LIBGENDIR)
	@echo Making $(CODELIB) for $(TARGETS)
	$(AR) $(ARFLAGS) $(LIBGENDIR)/$(CODELIB) $(TARGETS)

clean: subclean
	rm -f $(TARGETS) $(EXEC_TARGETS) $(CODE_LIB) $(LIBGENDIR)/$(CODELIB)
	rm -f *.o

topinstall: 
	mkdir -p $(YARP_ROOT)/lib/$(OS)
	mkdir -p $(YARP_ROOT)/include/yarp
	$(CP) $< $(YARP_ROOT)/lib/$(OS)
	$(CP) -f ../include/yarp/*.h $(YARP_ROOT)/include/yarp

install: target subinstall
	@echo Doing nothing as yet

subtarget :
	@for d in $(SUBDIRS) ; do \
		( cd $$d ; $(MAKE) $(MAKEFLAGS) target ) ; done

subclean :
	@for d in $(SUBDIRS) ; do \
		( cd $$d ; $(MAKE) $(MAKEFLAGS) clean ) ; done

subinstall :
	@for d in $(SUBDIRS) ; do \
		( cd $$d ; $(MAKE) $(MAKEFLAGS) install ) ; done

#deb:
#	@echo no deb packaging needed here

depend:
	makedepend -Y -I. $(INCS) -p$(GENDIR)/ *.cpp

msdev:
	msdev $(wildcard *.dsw) /MAKE

include $(YARP_ROOT)/conf/Makefile.dummy.template
